container_commands:
  01_download_epel:
    command: "sudo amazon-linux-extras install epel -y"
  02_enable_epel:
    command: "sudo yum-config-manager --enable epel"
  03_update_yum:
    command: "sudo yum update -y --skip-broken"
  04_install_certbot: 
    command: "sudo yum install -y certbot python2-certbot-nginx python2-pip"
  05_get_certificate:
    command: "sudo certbot certonly --standalone \
      --preferred-challenges http \
      --debug \
      --non-interactive \
      --email ${EMAIL} \
      --agree-tos \
      -d ${DOMAIN} \
      --expand \
      --test-cert \
      --renew-with-new-domains \
      --post-hook \"sudo service nginx start\" \
      --pre-hook \"sudo service nginx stop\""
  06_link:
    command: "sudo ln -sf /etc/letsencrypt/live/${DOMAIN} /etc/letsencrypt/live/ebcert"
